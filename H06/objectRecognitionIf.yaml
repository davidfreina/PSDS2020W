---
name: "objectRecognition"
dataIns:
- name: "videos"
  type: "number"
  source: "videos"
- name: "videoBucketId"
  type: "string"
  source: "videoBucketId"
- name: "extractedFramesBucket"
  type: "string"
  source: "extractedFramesBucket"
- name: "numberOfFramesToAnalyzePerInstance"
  type: "number"
  source: "numberOfFramesToAnalyzePerInstance"
workflowBody:
- parallelFor:
    name: "extractFramesParallel"
    dataIns:
    - name: "videoBucketId"
      type: "string"
      source: "objectRecognition/videoBucketId"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "extractedFramesBucket"
      type: "string"
      source: "objectRecognition/extractedFramesBucket"
    loopCounter:
      name: "numberOfVideos"
      type: "number"
      from: "0"
      to: "objectRecognition/videos"
      step: "1"
    loopBody:
    - function:
        name: "extractFrames"
        type: "extractFramesType"
        dataIns:
        - name: "videoBucketId"
          type: "string"
          source: "extractFramesParallel/videoBucketId"
        - name: "extractedFramesBucket"
          type: "string"
          source: "extractFramesParallel/extractedFramesBucket"
        dataOuts:
        - name: "extractFramesSuccess"
          type: "boolean"
        - name: "extractedFrames"
          type: "number"
        properties:
        - name: "resource"
          value: "FILL IN ARN"
    dataOuts:
    - name: "extractFramesSuccess"
      type: "collection"
      source: "extractFrames/extractFramesSuccess"
      constraints:
      - name: "aggregation"
        value: "+"
    - name: "extractedFrames"
      type: "number"
      source: "extractFrames/extractedFrames"
      constraints:
      - name: "aggregation"
        value: "+"
- parallelFor:
    name: "analyzeFramesParallel"
    dataIns:
    - name: "extractedFramesBucket"
      type: "string"
      source: "objectRecognition/extractedFramesBucket"
    loopCounter:
      name: "numberOfFrames"
      type: "number"
      from: "0"
      to: "extractFramesParallel/extractedFrames"
      step: "objectRecognition/numberOfFramesToAnalyzePerInstance"
    loopBody:
    - function:
        name: "analyzeFrames"
        type: "analyzeFramesType"
        dataIns:
        - name: "extractedFramesBucket"
          type: "string"
          source: "analyzeFramesParallel/extractedFramesBucket"
        dataOuts:
        - name: "analyzedFramesNames"
          type: "collection"
        properties:
        - name: "resource"
          value: "FILL IN ARN"
    - if:
        name: "IfThenElse"
        condition:
          conditions:
          - data1: "analyzedFramesNames"
            data2: "0"
            operator: ">"
        then:
        - function:
            name: "awsRekognition"
            type: "awsRekognitionType"
            dataIns:
            - name: "extractedFramesBucket"
              type: "string"
              source: "analyzeFramesParallel/extractedFramesBucket"
            - name: "analyzedFramesNames"
              type: "collection"
              source: "analyzeFrames/analyzedFramesNames"
            dataOuts:
            - name: "humanSentence"
              type: "string"
            properties:
            - name: "resource"
              value: "FILL IN ARN"
        else: []
    dataOuts:
    - name: "humanSentence"
      type: "collection"
      source: "awsRekognition/humanSentence"
      constraints:
      - name: "aggregation"
        value: "+"
dataOuts:
- name: "result"
  type: "collection"
  source: "analyzeFramesParallel/output"
